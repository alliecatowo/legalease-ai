[tools]
node = "24.10.0"
pnpm = "10.18.2"

[env]
QDRANT_URL = "http://localhost:6333"

[tasks]
# === Local Development (full Firebase Emulator Suite) ===
# One command starts everything: functions watch + all emulators + frontend
"dev:local" = """
echo 'üîß Starting local development with Firebase Emulator Suite...'
echo '‚ö†Ô∏è  Storage uses production (Speech API needs real GCS access)'
(cd functions && npm run build && npm run build:watch) &
pnpm exec firebase emulators:start --only functions,firestore,auth &
sleep 5
cd frontend && NUXT_PUBLIC_USE_EMULATORS=true pnpm dev
"""

# === Production Development (hits live Firebase) ===
dev = "cd frontend && pnpm dev"

# === Just the Emulator Suite (for manual testing) ===
emulators = "pnpm exec firebase emulators:start"

# === Build ===
build = "cd frontend && pnpm build && cd ../functions && npm run build"

# === Install ===
install = "cd frontend && pnpm install && cd ../functions && npm install"

# === Firebase ===
firebase = "pnpm exec firebase"
"firebase:login" = "pnpm exec firebase login"
deploy = "pnpm exec firebase deploy"
"deploy:hosting" = "pnpm exec firebase deploy --only hosting"
"deploy:functions" = "pnpm exec firebase deploy --only functions"

# === Local Qdrant (optional) ===
"qdrant:start" = "docker compose --profile local up -d qdrant"
"qdrant:stop" = "docker compose --profile local down"

# === Testing ===
test = "cd frontend && pnpm test"
"test:functions" = "cd functions && npm test"

# === Cleanup ===
clean = "rm -rf frontend/.nuxt frontend/.output functions/lib"
