const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./nJPhXMtH.js","./NGcmLKcR.js","./entry.Dr1rojeF.css","./eM47yAaV.js","./DlAUqK2U.js","./PDFViewerWithHighlights.YJcVjyIK.css"])))=>i.map(i=>d[i]);
import{d as W,e as v,a2 as J,f as M,N as I,p as X,D as y,o as x,L as m,j as T,s as d,a as i,M as Y,T as Z,K as w,c as G,w as $,J as ee,_ as te,X as oe,b0 as se,Y as ne}from"#entry";import{_ as ie}from"./zGKBPmqO.js";import{_ as ae}from"./CDi83SG1.js";import{_ as ce}from"./C0wxqGeD.js";import{_ as le}from"./BHe7gfhX.js";import{u as re}from"./CaoxetMn.js";import{_ as ue}from"./DlAUqK2U.js";import"./DvYBZqIB.js";import"./Dip1mGGo.js";import"./jxpb6RCH.js";import"./BSuOfW5l.js";const de=oe(()=>ne(()=>import("./nJPhXMtH.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(C=>C.default||C)),he={class:"document-viewer relative"},me={class:"viewer-toolbar bg-default border-b border-default p-3 flex items-center justify-between gap-3"},fe={class:"flex items-center gap-2"},ge={class:"flex items-center gap-2"},pe={class:"text-sm text-muted"},xe={class:"flex items-center gap-2"},_e={class:"flex items-center gap-2"},be={class:"viewer-content relative bg-muted/5"},ve={key:0,class:"flex items-center justify-center h-full"},ye={class:"text-center space-y-4"},we={key:1,class:"flex items-center justify-center h-full"},ke={class:"text-center space-y-4"},Ce={class:"text-muted"},Me={key:2,class:"pdf-wrapper"},$e={key:0,class:"viewer-footer border-t border-default p-3 bg-default"},ze={class:"flex items-center justify-between text-sm"},Pe={class:"flex items-center gap-4"},Ve={class:"text-muted"},Be={key:0,class:"text-muted"},De={key:0,class:"text-warning"},Ie=W({__name:"DocumentViewer",props:{documentId:{},searchQuery:{default:""},bm25Results:{default:()=>[]},fusionResults:{default:()=>[]},highlightBboxes:{default:()=>[]},initialPage:{default:1},chunkId:{}},setup(C){const h=C,j=re(),A=se(),z=v(""),u=v(h.initialPage),_=v(0),g=v(1),P=v(!0),V=v(null),L=J("pdfViewerRef"),p=v(null),b=M(()=>p.value?p.value.pages.find(e=>e.page_number===u.value):null),k=e=>{if(e.l!==void 0){const o=e.l,s=e.t??0,n=e.r??o,t=e.b??s;return{x:o,y:Math.min(s,t),width:Math.abs(n-o),height:Math.abs(t-s)}}else if(e.x0!==void 0){const o=e.x0,s=e.y0??0,n=e.x1??o,t=e.y1??s;return{x:o,y:Math.min(s,t),width:Math.abs(n-o),height:Math.abs(t-s)}}return{x:0,y:0,width:0,height:0}},N=e=>{const o=[];for(const s of e.bboxes||[]){const n=s.bbox?s.bbox:s,t=k(n);o.push({x:t.x,y:t.y,width:t.width,height:t.height,text:s.text})}for(const s of e.items)for(const n of s.bboxes||[]){const t=n.bbox?n.bbox:n,c=k(t);o.push({x:c.x,y:c.y,width:c.width,height:c.height,text:n.text||s.text})}return o},R=M(()=>{const e=[],o=[],s=new Set;for(const t of h.bm25Results||[]){const c=t.page_number||1;for(const l of t.bboxes||[]){const f=l.bbox?l.bbox:l,a=k(f);if(a.width===0||a.height===0)continue;const r=`${c}-${Math.round(a.x)}-${Math.round(a.y)}-${Math.round(a.width)}-${Math.round(a.height)}`;if(!s.has(r)&&(s.add(r),e.push({x:a.x,y:a.y,width:a.width,height:a.height,text:l.text||t.text,page:c,type:"bm25",score:t.score}),e.length>=5))break}if(e.length>=5)break}for(const t of h.fusionResults||[]){const c=t.page_number||1;for(const l of t.bboxes||[]){const f=l.bbox?l.bbox:l,a=k(f);if(a.width===0||a.height===0)continue;const r=`${c}-${Math.round(a.x)}-${Math.round(a.y)}-${Math.round(a.width)}-${Math.round(a.height)}`;if(!s.has(r)&&(s.add(r),o.push({x:a.x,y:a.y,width:a.width,height:a.height,text:l.text||t.text,page:c,type:"semantic",score:t.score}),o.length>=5))break}if(o.length>=5)break}const n=[...e,...o];return console.log(`[DocumentViewer] ${e.length} BM25 (blue), ${o.length} fusion (yellow)`),n});M(()=>{if(!p.value)return[];const e=(h.searchQuery||"").toLowerCase().trim();if(!e)return[];const o=[];for(const s of p.value.pages)for(const n of s.items)for(const t of n.bboxes||[]){const c=t.text||"";if(c&&c.toLowerCase().includes(e)){const l=t.bbox?t.bbox:t,f=k(l);o.push({x:f.x,y:f.y,width:f.width,height:f.height,text:c,page:s.page_number,type:"text"})}}return console.log(`[DocumentViewer] Text highlights: ${o.length}`),o});const B=M(()=>R.value.filter(e=>e.page===u.value));M(()=>{if(!b.value)return[];const e=[],o=(h.searchQuery||"").toLowerCase(),s=(n,t)=>{const c=n.bbox?n.bbox:n,l=k(c);e.push({x:l.x,y:l.y,width:l.width,height:l.height,text:n.text||t})};if(o)for(const n of b.value.items)for(const t of n.bboxes||[])(t.text||n.text||"").toLowerCase().includes(o)&&s(t,n.text);if(e.length===0){if(h.chunkId){const n=b.value.items.find(t=>t.chunk_id===h.chunkId);n&&(n.bboxes||[]).forEach(t=>s(t,n.text))}e.length===0&&!o&&N(b.value).forEach(n=>e.push(n))}return e});function U(){const e=(h.searchQuery||"").toLowerCase().trim();if(!(!e||!p.value?.pages)){for(const o of p.value.pages)if(o.items?.some(s=>(s.bboxes||[]).some(n=>(n.text||s.text||"").toLowerCase().includes(e)))){u.value=o.page_number;break}}}const D=async()=>{try{P.value=!0,V.value=null;const e=await j.documents.content(h.documentId.toString());p.value=e,z.value=`${A.public.apiBase}/api/v1/documents/${h.documentId}/download`,_.value=e.total_pages||e.pages?.length||0,U(),setTimeout(()=>{L.value?.totalPages&&(_.value=L.value.totalPages)},1e3)}catch(e){console.error("Error fetching document content:",e),V.value=e.message||"Failed to load document"}finally{P.value=!1}},E=e=>{e>=1&&e<=_.value&&(u.value=e)},Q=()=>E(u.value+1),F=()=>E(u.value-1),H=()=>{g.value=Math.min(g.value+.25,3)},S=()=>{g.value=Math.max(g.value-.25,.5)},q=()=>{g.value=1},K=()=>{if(!z.value)return;const e=window.open(z.value,"_blank");e&&e.addEventListener("load",()=>{e.print()})};return I([()=>h.searchQuery,p],()=>{U()}),I(()=>h.initialPage,e=>{u.value=e||1}),I(()=>h.documentId,()=>{u.value=h.initialPage||1}),X(()=>{D()}),I(()=>h.documentId,()=>{D()}),(e,o)=>{const s=Y,n=ie,t=te,c=ae,l=ce,f=le,a=de;return x(),y("div",he,[m("div",me,[m("div",fe,[d(s,{icon:"i-lucide-chevron-left",color:"neutral",variant:"ghost",size:"sm",disabled:i(u)<=1,onClick:F},null,8,["disabled"]),m("div",ge,[d(n,{modelValue:i(u),"onUpdate:modelValue":o[0]||(o[0]=r=>Z(u)?u.value=r:null),modelModifiers:{number:!0},type:"number",size:"sm",class:"w-16",min:1,max:i(_),onChange:o[1]||(o[1]=r=>E(i(u)))},null,8,["modelValue","max"]),m("span",pe,"/ "+w(i(_)),1)]),d(s,{icon:"i-lucide-chevron-right",color:"neutral",variant:"ghost",size:"sm",disabled:i(u)>=i(_),onClick:Q},null,8,["disabled"])]),m("div",xe,[d(s,{icon:"i-lucide-zoom-out",color:"neutral",variant:"ghost",size:"sm",disabled:i(g)<=.5,onClick:S},null,8,["disabled"]),d(s,{label:`${Math.round(i(g)*100)}%`,color:"neutral",variant:"ghost",size:"sm",onClick:q},null,8,["label"]),d(s,{icon:"i-lucide-zoom-in",color:"neutral",variant:"ghost",size:"sm",disabled:i(g)>=3,onClick:H},null,8,["disabled"])]),m("div",_e,[C.searchQuery&&i(B).length>0?(x(),G(l,{key:0,text:`${i(R).length} total highlights across document`},{default:$(()=>[d(c,{color:"warning",variant:"soft",size:"sm"},{leading:$(()=>[d(t,{name:"i-lucide-search",class:"size-3"})]),default:$(()=>[ee(" "+w(i(B).length)+" on this page ",1)]),_:1})]),_:1},8,["text"])):T("",!0),d(l,{text:"Print Document"},{default:$(()=>[d(s,{icon:"i-lucide-printer",color:"neutral",variant:"ghost",size:"sm",onClick:K})]),_:1}),d(s,{icon:"i-lucide-refresh-cw",color:"neutral",variant:"ghost",size:"sm",loading:i(P),onClick:D},null,8,["loading"])])]),m("div",be,[i(P)?(x(),y("div",ve,[m("div",ye,[d(t,{name:"i-lucide-loader-circle",class:"size-12 text-primary animate-spin mx-auto"}),o[3]||(o[3]=m("p",{class:"text-muted"},"Loading document...",-1))])])):i(V)?(x(),y("div",we,[d(f,{class:"max-w-md"},{default:$(()=>[m("div",ke,[d(t,{name:"i-lucide-alert-circle",class:"size-12 text-error mx-auto"}),o[4]||(o[4]=m("h3",{class:"text-lg font-semibold"},"Failed to Load Document",-1)),m("p",Ce,w(i(V)),1),d(s,{label:"Retry",icon:"i-lucide-refresh-cw",color:"primary",onClick:D})])]),_:1})])):(x(),y("div",Me,[d(a,{ref_key:"pdfViewerRef",ref:L,"document-url":i(z),page:i(u),zoom:i(g),"bounding-boxes":i(R).map((r,O)=>({id:String(O),page:r.page,x:r.x,y:r.y,width:r.width,height:r.height,text:r.text,type:r.type,entityType:r.type==="bm25"?"BM25_MATCH":"SEMANTIC_MATCH"})),onPageChange:o[2]||(o[2]=r=>u.value=r)},null,8,["document-url","page","zoom","bounding-boxes"])]))]),i(b)?(x(),y("div",$e,[m("div",ze,[m("div",Pe,[m("span",Ve," Page "+w(i(u))+" of "+w(i(_)),1),i(b).items.length>0?(x(),y("span",Be,w(i(b).items.length)+" elements ",1)):T("",!0)]),i(B).length>0?(x(),y("div",De,w(i(B).length)+" highlighted ",1)):T("",!0)])])):T("",!0)])}}}),Se=Object.assign(ue(Ie,[["__scopeId","data-v-746729a2"]]),{__name:"DocumentViewer"});export{Se as default};
