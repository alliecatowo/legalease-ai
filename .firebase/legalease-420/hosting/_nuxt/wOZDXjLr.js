import{e as M,f as F,a as t,a0 as le,p as ie,N as J,v as E,H as te,x as ae,y as se,ai as re,B as oe,C as P,D as p,o as u,s as R,w as K,j as m,F as C,r as d,L as w,E as c,G as ne,R as Z,J as j,K as L,M as ue,m as G,S as H,c as $,i as ce,a9 as de,_ as fe,P as pe}from"#entry";import{c as ve,d as ge,e as me}from"./DvYBZqIB.js";function ye(i){if(!i||i==="*")return;const y=i.split(",").map(b=>{const e=b.trim();return e.includes("/")&&e.endsWith("/*")&&e.split("/")[0]||e}).filter(b=>!b.startsWith("."));return y.length>0?y:void 0}function be(i){const{accept:y="*",reset:b=!1,multiple:e=!1,dropzone:U=!0,onUpdate:x}=i,a=M(),v=M(),O=F(()=>ye(t(y))),S=s=>{!s||s.length===0||(s instanceof FileList&&(s=Array.from(s)),s.length>1&&!e&&(s=[s[0]]),x(s))},q=M(!1),T=le({open:()=>{}});function g(){T.open()}return ie(()=>{const{isOverDropZone:s}=U?ve(v,{dataTypes:O.value,onDrop:S}):{isOverDropZone:M(!1)};J(s,B=>{q.value=B});const{onChange:z,open:V}=ge({accept:t(y),multiple:e,input:t(a),reset:b});T.open=V,z(B=>S(B))}),{isDragging:q,open:g,inputRef:a,dropzoneRef:v}}const he={slots:{root:"relative flex flex-col",base:["w-full flex-1 bg-default border border-default flex flex-col gap-2 items-stretch justify-center rounded-lg focus-visible:outline-2","transition-[background]"],wrapper:"flex flex-col items-center justify-center text-center",icon:"shrink-0",avatar:"shrink-0",label:"font-medium text-default mt-2",description:"text-muted mt-1",actions:"flex flex-wrap gap-1.5 shrink-0 mt-4",files:"",file:"relative",fileLeadingAvatar:"shrink-0",fileWrapper:"flex flex-col min-w-0",fileName:"text-default truncate",fileSize:"text-muted truncate",fileTrailingButton:""},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{area:{wrapper:"px-4 py-3",base:"p-4"},button:{}},size:{xs:{base:"text-xs",icon:"size-4",file:"text-xs px-2 py-1 gap-1",fileWrapper:"flex-row gap-1"},sm:{base:"text-xs",icon:"size-4",file:"text-xs px-2.5 py-1.5 gap-1.5",fileWrapper:"flex-row gap-1"},md:{base:"text-sm",icon:"size-5",file:"text-xs px-2.5 py-1.5 gap-1.5"},lg:{base:"text-sm",icon:"size-5",file:"text-sm px-3 py-2 gap-2",fileSize:"text-xs"},xl:{base:"text-base",icon:"size-6",file:"text-sm px-3 py-2 gap-2"}},layout:{list:{root:"gap-2 items-start",files:"flex flex-col w-full gap-2",file:"min-w-0 flex items-center border border-default rounded-md w-full",fileTrailingButton:"ms-auto"},grid:{fileWrapper:"hidden",fileLeadingAvatar:"size-full rounded-lg",fileTrailingButton:"absolute -top-1.5 -end-1.5 p-0 rounded-full border-2 border-bg"}},position:{inside:"",outside:""},dropzone:{true:"border-dashed data-[dragging=true]:bg-elevated/25"},interactive:{true:""},highlight:{true:""},multiple:{true:""},disabled:{true:"cursor-not-allowed opacity-75"}},compoundVariants:[{color:"primary",class:"focus-visible:outline-primary"},{color:"secondary",class:"focus-visible:outline-secondary"},{color:"success",class:"focus-visible:outline-success"},{color:"info",class:"focus-visible:outline-info"},{color:"warning",class:"focus-visible:outline-warning"},{color:"error",class:"focus-visible:outline-error"},{color:"primary",highlight:!0,class:"border-primary"},{color:"secondary",highlight:!0,class:"border-secondary"},{color:"success",highlight:!0,class:"border-success"},{color:"info",highlight:!0,class:"border-info"},{color:"warning",highlight:!0,class:"border-warning"},{color:"error",highlight:!0,class:"border-error"},{color:"neutral",class:"focus-visible:outline-inverted"},{color:"neutral",highlight:!0,class:"border-inverted"},{size:"xs",layout:"list",class:{fileTrailingButton:"-me-1"}},{size:"sm",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"md",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"lg",layout:"list",class:{fileTrailingButton:"-me-2"}},{size:"xl",layout:"list",class:{fileTrailingButton:"-me-2"}},{variant:"button",size:"xs",class:{base:"p-1"}},{variant:"button",size:"sm",class:{base:"p-1.5"}},{variant:"button",size:"md",class:{base:"p-1.5"}},{variant:"button",size:"lg",class:{base:"p-2"}},{variant:"button",size:"xl",class:{base:"p-2"}},{layout:"grid",multiple:!0,class:{files:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full",file:"p-0 aspect-square"}},{layout:"grid",multiple:!1,class:{file:"absolute inset-0 p-0"}},{interactive:!0,disabled:!1,class:"hover:bg-elevated/25"}],defaultVariants:{color:"primary",variant:"area",size:"md"}},ze=["id","name","accept","multiple","required","disabled"],ke=Object.assign({inheritAttrs:!1},{__name:"UFileUpload",props:E({as:{type:null,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},icon:{type:[String,Object],required:!1},label:{type:String,required:!1},description:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},layout:{type:null,required:!1,default:"grid"},position:{type:null,required:!1,default:"outside"},highlight:{type:Boolean,required:!1},accept:{type:String,required:!1,default:"*"},multiple:{type:Boolean,required:!1,default:!1},reset:{type:Boolean,required:!1,default:!1},dropzone:{type:Boolean,required:!1,default:!0},interactive:{type:Boolean,required:!1,default:!0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},fileIcon:{type:[String,Object],required:!1},fileDelete:{type:[Boolean,Object],required:!1},fileDeleteIcon:{type:[String,Object],required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:null},modelModifiers:{}}),emits:E(["change"],["update:modelValue"]),setup(i,{expose:y,emit:b}){const e=i,U=b,x=te(),a=ae(i,"modelValue"),v=se(),{t:O}=re(),[S,q]=me(),{isDragging:T,open:g,inputRef:s,dropzoneRef:z}=be({accept:e.accept,reset:e.reset,multiple:e.multiple,dropzone:e.dropzone,onUpdate:W}),{emitFormInput:V,emitFormChange:B,id:Q,name:X,disabled:D,ariaAttrs:Y}=oe(e),h=F(()=>e.multiple?"area":e.variant),N=F(()=>e.variant==="button"&&!e.multiple?"grid":e.layout),A=F(()=>N.value==="grid"&&e.multiple?"inside":h.value==="button"?"outside":e.position),o=F(()=>P({extend:P(he),...v.ui?.fileUpload||{}})({dropzone:e.dropzone,interactive:e.interactive,color:e.color,size:e.size,variant:h.value,layout:N.value,position:A.value,multiple:e.multiple,highlight:e.highlight,disabled:e.disabled}));function _(l){return URL.createObjectURL(l)}function ee(l){if(l===0)return"0B";const n=1024,r=["B","KB","MB","GB"],f=Math.floor(Math.log(l)/Math.log(n)),I=l/Math.pow(n,f);return`${f===0?I.toString():I.toFixed(0)}${r[f]}`}function W(l,n=!1){if(e.multiple)if(n)a.value=l;else{const f=a.value||[];a.value=[...f,...l||[]]}else a.value=l?.[0];const r=new Event("change",{target:{value:a.value}});U("change",r),B(),V()}function k(l){if(!a.value)return;if(!e.multiple||l===void 0){W([],!0),z.value?.focus();return}const n=[...a.value];n.splice(l,1),W(n,!0),z.value?.focus()}return J(a,l=>{(!Array.isArray(l)||!l.length)&&s.value&&(s.value.value="")}),y({inputRef:s,dropzoneRef:z}),(l,n)=>(u(),p(C,null,[R(t(S),null,{default:K(()=>[a.value&&(!Array.isArray(a.value)||a.value.length)?(u(),p(C,{key:0},[d(l.$slots,"files-top",{files:a.value,open:t(g),removeFile:k}),w("div",{class:c(o.value.files({class:e.ui?.files}))},[d(l.$slots,"files",{files:a.value},()=>[(u(!0),p(C,null,ne(Array.isArray(a.value)?a.value:[a.value],(r,f)=>(u(),p("div",{key:r.name,class:c(o.value.file({class:e.ui?.file}))},[d(l.$slots,"file",{file:r,index:f},()=>[d(l.$slots,"file-leading",{file:r,index:f},()=>[R(Z,{src:_(r),icon:i.fileIcon||t(v).ui.icons.file,size:e.size,class:c(o.value.fileLeadingAvatar({class:e.ui?.fileLeadingAvatar}))},null,8,["src","icon","size","class"])]),w("div",{class:c(o.value.fileWrapper({class:e.ui?.fileWrapper}))},[w("span",{class:c(o.value.fileName({class:e.ui?.fileName}))},[d(l.$slots,"file-name",{file:r,index:f},()=>[j(L(r.name),1)])],2),w("span",{class:c(o.value.fileSize({class:e.ui?.fileSize}))},[d(l.$slots,"file-size",{file:r,index:f},()=>[j(L(ee(r.size)),1)])],2)],2),d(l.$slots,"file-trailing",{file:r,index:f},()=>[R(ue,G({color:"neutral"},{ref_for:!0},{...N.value==="grid"?{variant:"solid",size:"xs"}:{variant:"link",size:i.size},...typeof i.fileDelete=="object"?i.fileDelete:void 0},{"aria-label":t(O)("fileUpload.removeFile",{filename:r.name}),"trailing-icon":i.fileDeleteIcon||t(v).ui.icons.close,class:o.value.fileTrailingButton({class:e.ui?.fileTrailingButton}),onClick:H(I=>k(f),["stop","prevent"])}),null,16,["aria-label","trailing-icon","class","onClick"])])])],2))),128))])],2),d(l.$slots,"files-bottom",{files:a.value,open:t(g),removeFile:k})],64)):m("",!0)]),_:3}),R(t(pe),{as:i.as,class:c(o.value.root({class:[e.ui?.root,e.class]}))},{default:K(()=>[d(l.$slots,"default",{open:t(g),removeFile:k},()=>[(u(),$(ce(h.value==="button"?"button":"div"),{ref_key:"dropzoneRef",ref:z,type:h.value==="button"?"button":void 0,role:h.value==="button"?void 0:"button","data-dragging":t(T),class:c(o.value.base({class:e.ui?.base})),tabindex:i.interactive&&!t(D)?0:-1,onClick:n[0]||(n[0]=r=>i.interactive&&!t(D)&&t(g)()),onKeydown:n[1]||(n[1]=H(()=>{},["prevent"])),onKeyup:n[2]||(n[2]=de(r=>i.interactive&&!t(D)&&t(g)(),["enter","space"]))},{default:K(()=>[A.value==="inside"?(u(),$(t(q),{key:0})):m("",!0),A.value!=="inside"||(i.multiple?!a.value?.length:!a.value)?(u(),p("div",{key:1,class:c(o.value.wrapper({class:e.ui?.wrapper}))},[d(l.$slots,"leading",{},()=>[h.value==="button"?(u(),$(fe,{key:0,name:i.icon||t(v).ui.icons.upload,class:c(o.value.icon({class:e.ui?.icon}))},null,8,["name","class"])):(u(),$(Z,{key:1,icon:i.icon||t(v).ui.icons.upload,size:e.size,class:c(o.value.avatar({class:e.ui?.avatar}))},null,8,["icon","size","class"]))]),h.value!=="button"?(u(),p(C,{key:0},[i.label||x.label?(u(),p("div",{key:0,class:c(o.value.label({class:e.ui?.label}))},[d(l.$slots,"label",{},()=>[j(L(i.label),1)])],2)):m("",!0),i.description||x.description?(u(),p("div",{key:1,class:c(o.value.description({class:e.ui?.description}))},[d(l.$slots,"description",{},()=>[j(L(i.description),1)])],2)):m("",!0),x.actions?(u(),p("div",{key:2,class:c(o.value.actions({class:e.ui?.actions}))},[d(l.$slots,"actions",{files:a.value,open:t(g),removeFile:k})],2)):m("",!0)],64)):m("",!0)],2)):m("",!0)]),_:3},40,["type","role","data-dragging","class","tabindex"])),A.value==="outside"?(u(),$(t(q),{key:0})):m("",!0)]),w("input",G({id:t(Q),ref_key:"inputRef",ref:s,type:"file",name:t(X),accept:i.accept,multiple:i.multiple,required:i.required,disabled:t(D)},{...l.$attrs,...t(Y)},{class:"sr-only",tabindex:"-1"}),null,16,ze)]),_:3},8,["as","class"])],64))}});export{ke as _};
